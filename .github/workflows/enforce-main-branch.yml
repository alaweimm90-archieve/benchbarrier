name: Enforce Main Branch Only

on:
  pull_request:
    types: [opened, synchronize, reopened]
  push:
    branches-ignore:
      - main

jobs:
  enforce-main-branch:
    runs-on: ubuntu-latest
    steps:
      - name: Check branch
        run: |
          echo "❌ ERROR: Only the main branch is allowed"
          echo "Branch: ${{ github.ref_name }}"
          echo ""
          echo "Please work directly on the main branch:"
          echo "  git checkout main"
          echo "  git pull origin main"
          echo "  # Make your changes"
          echo "  git add -A"
          echo "  git commit -m 'your message'"
          echo "  git push origin main"
          exit 1

  auto-close-pr:
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    steps:
      - name: Close PR
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.pulls.update({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.issue.number,
              state: 'closed'
            });
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: '❌ **Auto-closed**: This repository only uses the `main` branch.\n\nPlease work directly on `main` instead of creating PRs:\n```bash\ngit checkout main\ngit pull origin main\n# Make changes\ngit add -A\ngit commit -m "your message"\ngit push origin main\n```'
            });
